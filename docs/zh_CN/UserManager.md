# 用户管理

用户(user)不是账号(account)

使用ADB查看所有用户：

```shell
pm list users
```

上面这条命令返回的结果中，用户名前面的数字就是UserID

## 用户信息

用户已解锁：你能看到这个的时候一定解锁了

支持多用户：系统是否支持多用户。WearOS即使写着支持多用户，但不一定支持

系统用户：UserID为0的用户（需API23）

管理员用户：可以创建、删除用户。一个设备可以有多个管理员用户（需API34）

无头系统用户：系统用户运行着系统服务，但是没有分配给任何人使用，不能切换到系统用户（需API31，一般在Android Auto上使用）

可以登出：功能未知，无论什么用户都不能登出

临时用户：临时用户登出后或重启后会被删除（需API28）

附属用户：详见[附属用户ID](#附属用户ID)

UserID：不是UID。系统用户的UserID为0，其他用户（包括工作资料）的UserID从10开始计算

序列号：每个用户有不同的序列号（序列号和UserID可能是一样的，但是这是两个不同的东西）

## 用户操作

推荐使用用户序列号来标识用户，如果要使用UID，UID可以是运行在目标用户中的任意应用

无需输入UID/用户序列号的功能：

- 登出当前用户（需要是附属用户的Profile owner，需API28，如果是无头系统用户模式，会切换到前台用户）

需要输入UID/用户序列号的功能：

- 在后台启动用户（需Device owner和API28）
- 切换至用户（需Device owner）
- 停止用户（需Device owner和API28）
- 移除用户（需Device owner）

## 创建并管理用户

创建一个受管理用户，新用户的头像右下方会有公文包标志

需要Device owner和API24

选项：

- 跳过创建用户向导（切换到新用户之后的向导）
- 临时用户（需API28）
- 启用所有系统应用（有些系统应用在新用户中是默认不启用的，比如谷歌手机上的YouTube）

创建后，OwnDroid会成为受管理用户中的Profile owner

::: info 给WearOS用户的提示

这个功能在WearOS上使用会导致SystemUI停止运行一次，过几秒恢复正常。创建用户实际上成功了，回到OwnDroid后能看到新用户的序列号，`pm list users`也能看到新用户。如果切换到新用户，SystemUI无法使用，表现为黑屏（可以用ADB命令启动别的应用）。如果黑屏无法使用，ADB执行下面这个命令（把USER_ID替换成受管理用户的用户序列号）

```shell
pm remove-user --set-ephemeral-if-in-use USER_ID
```

新用户会被设为临时用户，重启后临时用户会被删除并切换到主用户

（原生WearOS4(AVD)会出现这个问题，其他版本不知道有没有这个问题）

:::

## 附属用户ID

需要Device owner或Profile owner（工作资料中的Profile owner虽然也能设置，但是没有实际作用）

附属用户ID是一个列表，列表中可以有多个不相同的ID，不考虑顺序

当Device owner创建并管理用户时，新的用户不是附属用户。Device owner设置和受管理用户完全相同的附属用户ID后，受管理用户成为附属于Device owner的用户

Device owner无论在何时都是附属于设备的用户

你可以在用户管理->[用户信息](#用户信息)查看当前用户是否附属用户

## 用户名

修改当前用户的用户名

需要Device owner或Profile owner

## 用户图标

选择一个图片并设置为当前用户的图标

需要Device owner或Profile owner

需要API23或以上

尽量选择一个正方形的图片，分辨率不要太大，以免产生问题

## 用户会话开始/结束消息

用户会话开始消息：切换到非系统用户时的消息

用户会话结束消息：切换回系统用户时的消息

